#!/bin/bash

# ========== SPRB ç‹¬ç«‹è¿›åº¦é¡µé¢åœæ­¢è„šæœ¬ ==========
# åŠŸèƒ½ï¼šåœæ­¢ç‹¬ç«‹è¿›åº¦é¡µé¢æœåŠ¡å™¨
# ===============================================

set -e

echo "ğŸ›‘ æ­£åœ¨åœæ­¢SPRBç‹¬ç«‹è¿›åº¦é¡µé¢æœåŠ¡å™¨..."

# æŸ¥æ‰¾å¹¶æ€æ­»ç›¸å…³è¿›ç¨‹
pids=$(lsof -ti :3002 2>/dev/null || true)
if [ -n "$pids" ]; then
    echo "ğŸ”ª æ€æ­»å ç”¨ 3002 çš„è¿›ç¨‹: $pids"
    kill -9 $pids || true
    echo "âœ… è¿›ç¨‹å·²åœæ­¢"
else
    echo "â„¹ï¸  æ²¡æœ‰æ‰¾åˆ°è¿è¡Œåœ¨3002ç«¯å£çš„è¿›ç¨‹"
fi

# æ£€æŸ¥ç«¯å£çŠ¶æ€
sleep 2
if netstat -tln | grep -q ":3002 "; then
    echo "âŒ ç«¯å£ 3002 ä»åœ¨ç›‘å¬"
else
    echo "âœ… ç«¯å£ 3002 å·²é‡Šæ”¾"
fi

echo "ğŸ‰ ç‹¬ç«‹è¿›åº¦é¡µé¢æœåŠ¡å™¨å·²åœæ­¢" 