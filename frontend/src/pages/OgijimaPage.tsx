import React, { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import styled from 'styled-components'
import { motion, AnimatePresence } from 'framer-motion'
import ImageSlider from '../components/ImageSlider'

// Âú∞ÂõæÂõæÊ†áÊé•Âè£ÂÆö‰πâ
interface CheckInIcon {
  x: number
  y: number
  emoji?: string
  icon?: string
  title: string
  iconType: 'emoji' | 'image'
  size: number
}

const Container = styled.div`
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: linear-gradient(
    135deg, 
    #87CEEB 0%,    /* Â§©ËìùËâ≤ */
    #98E4D6 20%,   /* ËñÑËç∑Áªø */
    #F4E285 40%,   /* ÊµÖÈªÑËâ≤ */
    #FFB347 60%,   /* ÈáëÊ©ôËâ≤ */
    #FF8C69 80%,   /* ÁèäÁëöËâ≤ */
    #FFA07A 100%   /* ÊµÖÊ©ôËâ≤ */
  );
  position: relative;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 20px;
  padding-top: 30px;
  padding-bottom: 40px;
`

const HeaderSection = styled.div`
  text-align: center;
  margin-bottom: 40px;
`

const Title = styled.h1`
  font-size: 48px;
  color: #5d4037;
  margin-bottom: 10px;
  font-weight: 700;
  font-family: 'KaiTi', 'SimKai', serif;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
`

const Icon = styled.span`
  font-size: 60px;
  display: inline-flex;
  align-items: center;
  
  img {
    width: 60px;
    height: 60px;
    object-fit: contain;
  }
`

const Subtitle = styled.h2`
  font-size: 24px;
  color: #ff6b35;
  margin-bottom: 20px;
  font-weight: 600;
  text-align: center;
`

const ContentContainer = styled.div`
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 30px;
`

const InfoCard = styled(motion.div)`
  background: rgba(255, 255, 255, 0.95);
  border-radius: 20px;
  padding: 40px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(20px);
  border: 3px solid rgba(255, 255, 255, 0.3);
  position: relative;
  overflow: hidden;
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
      rgba(255, 107, 53, 0.05) 0%,
      rgba(135, 206, 235, 0.05) 50%,
      rgba(152, 228, 214, 0.05) 100%
    );
    z-index: -1;
    opacity: 0;
    transition: opacity 0.6s ease;
  }
  
  &:hover::before {
    opacity: 1;
  }
`

const SectionTitle = styled.h3`
  font-size: 28px;
  color: #5d4037;
  margin-bottom: 20px;
  font-weight: 700;
  font-family: 'KaiTi', 'SimKai', serif;
  text-align: center;
`

const Description = styled.p`
  font-size: 18px;
  color: #444;
  line-height: 1.8;
  margin-bottom: 20px;
  text-align: left;
  text-indent: 2em;
  position: relative;
  
  &::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 3px;
    height: 100%;
    background: linear-gradient(180deg, #ff6b35, #ffa500);
    border-radius: 2px;
    opacity: 0;
    transition: opacity 0.4s ease;
  }
  
  &:hover::before {
    opacity: 1;
  }
`

const MapFrame = styled.div`
  width: fit-content;
  max-width: 95%;
  padding: 20px;
  background: rgba(255, 255, 255, 0.1);
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 30px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(10px);
  margin: 30px auto;
  display: flex;
  justify-content: center;
  align-items: center;
`

const MapContainer = styled.div`
  width: fit-content;
  background: #f0f8ff;
  border-radius: 20px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
`

const MapImage = styled.img<{ scale: number }>`
  width: ${props => props.scale * 800}px;
  max-width: 100vw;
  height: auto;
  border-radius: 20px;
  display: block;
`

const MapOverlay = styled.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 20px;
  pointer-events: none;
`

const LocationIcon = styled(motion.div)<{ x: number; y: number; iconSize: number }>`
  position: absolute;
  font-size: ${props => props.iconSize}px;
  cursor: pointer;
  left: ${props => props.x}%;
  top: ${props => props.y}%;
  transform: translate(-50%, -50%);
  z-index: 10;
  pointer-events: auto;
  filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.5));
  display: flex;
  align-items: center;
  justify-content: center;
  
  img {
    width: ${props => props.iconSize}px;
    height: ${props => props.iconSize}px;
    object-fit: contain;
  }
`

const ImageGallery = styled.div`
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-top: 20px;
  max-height: 280px;
  overflow-y: auto;
  overflow-x: hidden;
  padding-right: 10px;
  
  /* Ëá™ÂÆö‰πâÊªöÂä®Êù°Ê†∑Âºè */
  &::-webkit-scrollbar {
    width: 8px;
  }
  
  &::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
  }
  
  &::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    
    &:hover {
      background: rgba(255, 255, 255, 0.5);
    }
  }

  /* ÂìçÂ∫îÂºèËÆæËÆ° */
  @media (max-width: 768px) {
    grid-template-columns: 1fr;
    max-height: 600px;
  }
  
  @media (max-width: 1024px) and (min-width: 769px) {
    grid-template-columns: repeat(2, 1fr);
    max-height: 400px;
  }
`

const ImageCard = styled(motion.div)`
  background: rgba(255, 255, 255, 0.9);
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  
  &:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
  }
`

const LocationTitle = styled.h4`
  padding: 15px 15px 5px 15px;
  font-size: 18px;
  color: #5d4037;
  text-align: center;
  margin: 0;
  font-weight: 700;
  font-family: 'KaiTi', 'SimKai', serif;
`

const ImageCaption = styled.p`
  padding: 5px 15px 15px 15px;
  font-size: 14px;
  color: #666;
  text-align: center;
  margin: 0;
  line-height: 1.4;
`

const ButtonContainer = styled.div`
  display: flex;
  gap: 20px;
  justify-content: center;
  align-items: center;
  margin-top: 40px;
`

const BackButton = styled(motion.button)`
  background: linear-gradient(45deg, #87CEEB, #98E4D6);
  border: none;
  border-radius: 50px;
  padding: 15px 25px;
  font-size: 18px;
  color: #2E8B57;
  cursor: pointer;
  box-shadow: 0 6px 20px rgba(135, 206, 235, 0.4);
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  z-index: 100;
  
  &:hover {
    background: linear-gradient(45deg, #98E4D6, #87CEEB);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(135, 206, 235, 0.5);
  }
`

// ÂõæÁâáÊü•ÁúãÂô®Ê®°ÊÄÅÊ°ÜÊ†∑Âºè
const ModalOverlay = styled(motion.div)`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
`

const ModalContent = styled(motion.div)`
  position: relative;
  max-width: 90vw;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
`

const ModalImage = styled.img`
  max-width: 100%;
  max-height: 80vh;
  object-fit: contain;
  border-radius: 10px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
`

const ModalInfo = styled.div`
  text-align: center;
  color: white;
`

const ModalTitle = styled.h3`
  font-size: 24px;
  margin: 0 0 10px 0;
  color: #fff;
  font-family: 'KaiTi', 'SimKai', serif;
`

const ModalLabel = styled.p`
  font-size: 18px;
  margin: 0;
  color: #ccc;
`

const CloseButton = styled(motion.button)`
  position: absolute;
  top: -50px;
  right: 0;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  color: white;
  font-size: 20px;
  cursor: none !important; /* ü¶ã ‰ΩøÁî®Ëù¥Ëù∂Èº†Ê†á */
  display: flex;
  align-items: center;
  justify-content: center;
  transition: none; /* üîß ÁßªÈô§CSS transitionÔºåÈÅøÂÖç‰∏éframer-motionÂÜ≤Á™Å */
`

const NavigationButton = styled(motion.button)<{ direction: 'prev' | 'next' }>`
  position: absolute;
  top: 50%;
  ${props => props.direction === 'prev' ? 'left: -60px;' : 'right: -60px;'}
  transform: translateY(-50%);
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  color: white;
  font-size: 24px;
  cursor: none !important; /* ü¶ã ‰ΩøÁî®Ëù¥Ëù∂Èº†Ê†á */
  display: flex;
  align-items: center;
  justify-content: center;
  transition: none; /* üîß ÁßªÈô§CSS transitionÔºåÈÅøÂÖç‰∏éframer-motionÂÜ≤Á™Å */
  
  @media (max-width: 768px) {
    ${props => props.direction === 'prev' ? 'left: 10px;' : 'right: 10px;'}
    top: auto;
    bottom: 20px;
  }
`

// Ê†áÁ≠æÂàáÊç¢ÁªÑ‰ª∂Ê†∑Âºè
const TabContainer = styled.div`
  display: flex;
  margin-bottom: 30px;
  border-radius: 15px;
  background: rgba(255, 255, 255, 0.2);
  padding: 5px;
  backdrop-filter: blur(10px);
`

const TabButton = styled(motion.button)<{ active: boolean; tabType: 'intro' | 'guide' }>`
  flex: 1;
  padding: 15px 20px;
  border: none;
  border-radius: 10px;
  background: ${props => {
    if (props.active) {
      return props.tabType === 'intro' 
        ? 'linear-gradient(135deg, #ff6b35, #ffa500)'
        : 'linear-gradient(135deg, #87ceeb, #98e4d6)';
    }
    return 'transparent';
  }};
  color: ${props => {
    if (props.active) {
      return props.tabType === 'intro' ? 'white' : '#2e8b57';
    }
    return '#8d6e63';
  }};
  font-size: 18px;
  font-weight: 600;
  font-family: 'KaiTi', 'SimKai', serif;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  box-shadow: ${props => props.active 
    ? (props.tabType === 'intro' 
      ? '0 6px 20px rgba(255, 107, 53, 0.3)' 
      : '0 6px 20px rgba(135, 206, 235, 0.3)')
    : 'none'};
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent, 
      rgba(255, 255, 255, 0.3), 
      transparent
    );
    transition: left 0.8s ease;
    z-index: 1;
  }
  
  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: ${props => 
      props.tabType === 'intro' 
        ? 'linear-gradient(135deg, #ff8a50, #ffb347)'
        : 'linear-gradient(135deg, #98d8eb, #a8e6d2)'};
    opacity: 0;
    transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 10px;
    z-index: -1;
  }
  
  &:hover {
    transform: translateY(-2px);
    box-shadow: ${props => 
      props.tabType === 'intro' 
        ? '0 8px 25px rgba(255, 107, 53, 0.4)'
        : '0 8px 25px rgba(135, 206, 235, 0.4)'};
    
    &::before {
      left: 100%;
    }
    
    &::after {
      opacity: ${props => props.active ? 0 : 0.6};
    }
  }
  
  &:active {
    transform: translateY(0);
    transition: transform 0.1s ease;
  }
`

const ContentSection = styled(motion.div)`
  width: 100%;
`

// ÂõæÁâáÊü•ÁúãÂô®ÁªÑ‰ª∂
interface ImageViewerProps {
  isOpen: boolean;
  onClose: () => void;
  images: Array<{ src: string; label: string }>;
  currentIndex: number;
  onPrevious: () => void;
  onNext: () => void;
  title: string;
}

const ImageViewer: React.FC<ImageViewerProps> = ({
  isOpen,
  onClose,
  images,
  currentIndex,
  onPrevious,
  onNext,
  title
}) => {
  if (!isOpen || images.length === 0) return null;

  return (
    <AnimatePresence>
      <ModalOverlay
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
        onClick={onClose}
      >
        <ModalContent
          initial={{ scale: 0.8, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          exit={{ scale: 0.8, opacity: 0 }}
          onClick={(e) => e.stopPropagation()}
        >
          <CloseButton
            onClick={onClose}
            whileHover={{ 
              scale: 1.05,
              background: "rgba(255, 255, 255, 0.2)",
              borderColor: "rgba(255, 255, 255, 0.5)"
            }}
            whileTap={{ scale: 0.98 }}
            transition={{ 
              type: "spring",
              stiffness: 400,
              damping: 25,
              duration: 0.15
            }}
          >
            ‚úï
          </CloseButton>
          
          {images.length > 1 && (
            <>
              <NavigationButton
                direction="prev"
                onClick={onPrevious}
                whileHover={{ 
                  scale: 1.05,
                  background: "rgba(255, 255, 255, 0.2)",
                  borderColor: "rgba(255, 255, 255, 0.5)"
                }}
                whileTap={{ scale: 0.98 }}
                transition={{ 
                  type: "spring",
                  stiffness: 400,
                  damping: 25,
                  duration: 0.15
                }}
              >
                ‚Äπ
              </NavigationButton>
              
              <NavigationButton
                direction="next"
                onClick={onNext}
                whileHover={{ 
                  scale: 1.05,
                  background: "rgba(255, 255, 255, 0.2)",
                  borderColor: "rgba(255, 255, 255, 0.5)"
                }}
                whileTap={{ scale: 0.98 }}
                transition={{ 
                  type: "spring",
                  stiffness: 400,
                  damping: 25,
                  duration: 0.15
                }}
              >
                ‚Ä∫
              </NavigationButton>
            </>
          )}
          
          <ModalImage
            src={images[currentIndex]?.src}
            alt={`${title} - ${images[currentIndex]?.label}`}
          />
          
          <ModalInfo>
            <ModalTitle>{title}</ModalTitle>
            <ModalLabel>{images[currentIndex]?.label}</ModalLabel>
          </ModalInfo>
        </ModalContent>
      </ModalOverlay>
    </AnimatePresence>
  );
};

// Tooltip ÁªÑ‰ª∂
const MapTooltip = styled.div<{ direction: 'top' | 'bottom' }>`
  position: absolute;
  left: 50%;
  ${props => props.direction === 'top' ? 'top: -10px; transform: translate(-50%, -100%);' : 'bottom: -10px; transform: translate(-50%, 100%);'}
  background: #fff;
  color: #333;
  border-radius: 14px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.18);
  padding: 16px 10px 12px 10px;
  min-width: 220px;
  max-width: 320px;
  z-index: 999;
  display: flex;
  flex-direction: column;
  align-items: center;
  pointer-events: none;
  opacity: 0.98;
  &::after {
    content: '';
    position: absolute;
    left: 50%;
    ${props => props.direction === 'top' ? 'bottom: -10px;' : 'top: -10px;'}
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    ${props => props.direction === 'top' ? 'border-top: 10px solid #fff;' : 'border-bottom: 10px solid #fff;'}
    box-shadow: 0 4px 24px rgba(0,0,0,0.10);
  }
  &::before {
    content: '';
    position: absolute;
    left: 50%;
    ${props => props.direction === 'top' ? 'bottom: -11px;' : 'top: -11px;'}
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 11px solid transparent;
    border-right: 11px solid transparent;
    ${props => props.direction === 'top' ? 'border-top: 1px solid #ececec;' : 'border-bottom: 1px solid #ececec;'}
  }
`;
const TooltipImage = styled.img`
  width: 100%;
  height: auto;
  object-fit: cover;
  border-radius: 10px;
  margin: 0 0 8px 0;
  display: block;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
`;
const TooltipTitle = styled.div`
  font-size: 16px;
  font-weight: 700;
  color: #5d4037;
  margin-bottom: 4px;
  text-align: center;
`;
const TooltipDesc = styled.div`
  font-size: 14px;
  color: #666;
  text-align: center;
`;

const iconTooltips: Record<string, { image: string; desc: string }> = {
  'Ê≥≥Ê±†': {
    image: 'images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-Ê≥≥Ê±†.webp',
    desc: '‰∏éÁôΩÁæΩÁõ∏ÈÅáÁöÑÂú∞Êñπ',
  },
  'È∏•Áõ∏ÈÅáÂ∞èÈÅì': {
    image: 'images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È∏•Áõ∏ÈÅáÂ∞èÈÅì.webp',
    desc: '‰∏éÈ∏•Áõ∏ÈÅáÁöÑÁæé‰∏ΩÂ∞èÂæÑ',
  },
  'È∏üÁôΩÂ≤õÂΩπÂú∫': {
    image: 'images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È∏üÁôΩÂ≤õÂΩπÂú∫.webp',
    desc: 'Â≤õ‰∏äÈáçË¶ÅÁöÑË°åÊîøÂú∫ÊâÄ',
  },
  'ÁßòÂØÜÂü∫Âú∞': {
    image: 'images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁßòÂØÜÂü∫Âú∞.webp',
    desc: '‰∏éÂ§©ÂñÑÊâì‰πí‰πìÁêÉÁöÑÂú∞Êñπ',
  },
  'ÁÅØÂ°î': {
    image: 'images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁÅØÂ°î.webp',
    desc: '‰∏éÂ∞èÁ¥¨Áõ∏ÈÅáÁöÑÂú∞Êñπ',
  },
  'ËãçÁù°ËßâÂ∞èÈÅì': {
    image: 'images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ËãçÁù°ËßâÂ∞èÈÅì.webp',
    desc: '‰∏éËãçÁõ∏ÈÅáÁöÑÂú∞Êñπ',
  },
  'Èùô‰πÖÁ•ûÁ§æ': {
    image: 'images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-Èùô‰πÖÁ•ûÁ§æÂõæ.webp',
    desc: '‰∏éÈùô‰πÖË∑ØËøáÁöÑÈ∏üÂ±Ö',
  },
  'È¨ºÂß¨Á•ûÂ±±ËØÜ‰πãÂ¢ì': {
    image: 'images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È¨ºÂß¨Á•ûÂ±±ËØÜ‰πãÂ¢ì.webp',
    desc: '‰∏é„ÄÇ„ÄÇ„ÄÇ',
  },
  'ÊîæÈÄÅÂ°î': {
    image: 'images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÊîæÈÄÅÂ°î.webp',
    desc: 'ÁæéÂ∏åÁ≠âÁà∏Áà∏Â¶àÂ¶àÁöÑÂú∞ÁÇπ',
  },
  'Èò≤Ê≥¢Â†§': {
    image: 'images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-Èò≤Ê≥¢Â†§.webp',
    desc: 'ÁôΩÁæΩ‰∏ªËßÜËßâ',
  },
};

const OgijimaPage: React.FC = () => {
  const navigate = useNavigate()
  
  // ÂõæÁâáÊü•ÁúãÂô®Áä∂ÊÄÅ
  const [imageViewer, setImageViewer] = useState({
    isOpen: false,
    images: [] as Array<{ src: string; label: string }>,
    currentIndex: 0,
    title: ''
  });
  
  // ‰ø°ÊÅØÂç°ÁâáÂàáÊç¢Áä∂ÊÄÅ
  const [activeTab, setActiveTab] = useState<'intro' | 'guide'>('intro');

  // Âú∞Ê†áÊÇ¨ÂÅúÁä∂ÊÄÅ
  const [hoveredIcon, setHoveredIcon] = useState<string | null>(null);
  // ÁßªÈô§ tooltipPos Áõ∏ÂÖ≥
  
  // Âú∞ÂõæÁº©ÊîæÊØî‰æãÂèÇÊï∞
  // Ë∞ÉÊï¥Ê≠§ÂÄºÊù•ÊéßÂà∂Âú∞ÂõæÂ§ßÂ∞èÔºö
  // 0.5 = 50% Â§ßÂ∞è (400px ÂÆΩ)
  // 1.0 = 100% Â§ßÂ∞è (800px ÂÆΩ)  
  // 1.5 = 150% Â§ßÂ∞è (1200px ÂÆΩ)
  const mapScale = 1.0

  // Âú∞ÂõæÂõæÊ†áÂùêÊ†áÂèÇÊï∞ (0-100ÁöÑÁôæÂàÜÊØî)
  // ÂèØ‰ª•ÊâãÂä®Ë∞ÉËäÇËøô‰∫õÊï∞ÂÄºÊù•ÁßªÂä®ÂõæÊ†á‰ΩçÁΩÆ
  // sizeÂèÇÊï∞ÊéßÂà∂ÂõæÊ†áÂ§ßÂ∞èÔºåÂçï‰Ωç‰∏∫ÂÉèÁ¥† (Âª∫ËÆÆËåÉÂõ¥: 16-40)
  const checkInIcons: CheckInIcon[] = [
    { x: 28, y: 78, emoji: 'üèä', title: 'Ê≥≥Ê±†', iconType: 'emoji', size: 24 },
    { x: 51, y: 78, icon: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È∏•Áõ∏ÈÅáÂ∞èÈÅìÂõæÊ†á.webp", title: 'È∏•Áõ∏ÈÅáÂ∞èÈÅì', iconType: 'image', size: 50 },
    { x: 23, y: 74, emoji: 'üèõÔ∏è', title: 'È∏üÁôΩÂ≤õÂΩπÂú∫', iconType: 'emoji', size: 24 },
    { x: 28, y: 76, icon: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁßòÂØÜÂü∫Âú∞ÂõæÊ†á.webp", title: 'ÁßòÂØÜÂü∫Âú∞', iconType: 'image', size: 35 },
    { x: 60, y: 3, icon: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁÅØÂ°îÂõæÊ†á.webp", title: 'ÁÅØÂ°î', iconType: 'image', size: 32 },
    { x: 31, y: 52, emoji: 'üí§', title: 'ËãçÁù°ËßâÂ∞èÈÅì', iconType: 'emoji', size: 40 },
    { x: 33, y: 60, emoji: '‚õ©Ô∏è', title: 'Èùô‰πÖÁ•ûÁ§æ', iconType: 'emoji', size: 35 },
    { x: 54, y: 5, icon: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È¨ºÂß¨Á•ûÂ±±ËØÜ‰πãÂ¢ìÂõæÊ†á.webp", title: 'È¨ºÂß¨Á•ûÂ±±ËØÜ‰πãÂ¢ì', iconType: 'image', size: 45 },
    { x: 24, y: 65, icon: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÊîæÈÄÅÂ°îÂõæÊ†á.webp", title: 'ÊîæÈÄÅÂ°î', iconType: 'image', size: 28 },
    { x: 16, y: 74, emoji: 'üåä', title: 'Èò≤Ê≥¢Â†§', iconType: 'emoji', size: 24 }
  ];

  // ÊâìÂç°Âú∞ÁÇπÂõæÁâáÊï∞ÊçÆ
  const checkInLocations = [
    {
      title: "Ê≥≥Ê±†",
      description: "‰∏éÁôΩÁæΩÁõ∏ÈÅáÁöÑÂú∞Êñπ",
      images: [
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-Ê≥≥Ê±†.webp", label: "ÁôΩÂ§©" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-Ê≥≥Ê±†-ÈªÑÊòè.webp", label: "ÈªÑÊòè" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-Ê≥≥Ê±†-Â§úÊôö.webp", label: "Â§úÊôö" }
      ]
    },
    {
      title: "È∏•Áõ∏ÈÅáÂ∞èÈÅì",
      description: "‰∏éÈ∏•Áõ∏ÈÅáÁöÑÁæé‰∏ΩÂ∞èÂæÑ",
      images: [
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È∏•Áõ∏ÈÅáÂ∞èÈÅì.webp", label: "ÁôΩÂ§©" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È∏•Áõ∏ÈÅáÂ∞èÈÅì-ÈªÑÊòè.webp", label: "ÈªÑÊòè" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È∏•Áõ∏ÈÅáÂ∞èÈÅì-Â§úÊôö.webp", label: "Â§úÊôö" }
      ]
    },
    {
      title: "È∏üÁôΩÂ≤õÂΩπÂú∫",
      description: "Â≤õ‰∏äÈáçË¶ÅÁöÑË°åÊîøÂú∫ÊâÄ",
      images: [
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È∏üÁôΩÂ≤õÂΩπÂú∫.webp", label: "ÁôΩÂ§©" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È∏üÁôΩÂ≤õÂΩπÂú∫-ÈªÑÊòè.webp", label: "ÈªÑÊòè" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È∏üÁôΩÂ≤õÂΩπÂú∫-Â§úÊôö.webp", label: "Â§úÊôö" }
      ]
    },
    {
      title: "ÁßòÂØÜÂü∫Âú∞",
      description: "‰∏éÂ§©ÂñÑÊâì‰πí‰πìÁêÉÁöÑÂú∞Êñπ",
      images: [
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁßòÂØÜÂü∫Âú∞.webp", label: "ÁôΩÂ§©" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁßòÂØÜÂü∫Âú∞-ÈªÑÊòè.webp", label: "ÈªÑÊòè" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁßòÂØÜÂü∫Âú∞-Â§úÊôö.webp", label: "Â§úÊôö" }
      ]
    },
    {
      title: "Á¥¨ÁöÑÁÅØÂ°î",
      description: "‰∏éÂ∞èÁ¥¨Áõ∏ÈÅáÁöÑÂú∞Êñπ",
      images: [
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁÅØÂ°î.webp", label: "ÁôΩÂ§©" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁÅØÂ°î-ÈªÑÊòè.webp", label: "ÈªÑÊòè" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁÅØÂ°î-Â§úÊôö-‰∫ÆÁÅØ.webp", label: "Â§úÊôö-‰∫ÆÁÅØ" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁÅØÂ°î-Â§úÊôö-ÁÜÑÁÅØ.webp", label: "Â§úÊôö-ÁÜÑÁÅØ" }
      ]
    },
    {
      title: "ËãçÁù°ËßâÂ∞èÈÅì",
      description: "‰∏éËãçÁõ∏ÈÅáÁöÑÂú∞Êñπ",
      images: [
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ËãçÁù°ËßâÂ∞èÈÅì.webp", label: "ÁôΩÂ§©" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ËãçÁù°ËßâÂ∞èÈÅì-ÈªÑÊòè.webp", label: "ÈªÑÊòè" },
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ËãçÁù°ËßâÂ∞èÈÅì-Â§úÊôö.webp", label: "Â§úÊôö" }
      ]
    },
    {
      title: "Èùô‰πÖÁ•ûÁ§æ",
      description: "‰∏éÈùô‰πÖË∑ØËøáÁöÑÈ∏üÂ±Ö",
      images: [
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-Èùô‰πÖÁ•ûÁ§æÂõæ.webp", label: "Èùô‰πÖÁ•ûÁ§æ" }
      ]
    },
    {
      title: "È¨ºÂß¨Á•ûÂ±±ËØÜ‰πãÂ¢ì",
      description: "‰∏é„ÄÇ„ÄÇ„ÄÇ",
      images: [
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-È¨ºÂß¨Á•ûÂ±±ËØÜ‰πãÂ¢ì.webp", label: "È¨ºÂß¨Á•ûÂ±±ËØÜ‰πãÂ¢ì" }
      ]
    },
    {
      title: "ÊîæÈÄÅÂ°î",
      description: "ÁæéÂ∏åÁ≠âÁà∏Áà∏Â¶àÂ¶àÁöÑÂú∞ÁÇπ",
      images: [
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÊîæÈÄÅÂ°î.webp", label: "ÊîæÈÄÅÂ°î" }
      ]
    },
    {
      title: "Èò≤Ê≥¢Â†§",
      description: "ÁôΩÁæΩ‰∏ªËßÜËßâ",
      images: [
        { src: "images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-Èò≤Ê≥¢Â†§.webp", label: "Èò≤Ê≥¢Â†§" }
      ]
    }
  ]

  const handleBack = () => {
    navigate('/checkin')
  }

  // ÊâìÂºÄÂõæÁâáÊü•ÁúãÂô®
  const openImageViewer = (images: Array<{ src: string; label: string }>, currentIndex: number, title: string) => {
    setImageViewer({
      isOpen: true,
      images,
      currentIndex,
      title
    });
  };

  // ÂÖ≥Èó≠ÂõæÁâáÊü•ÁúãÂô®
  const closeImageViewer = () => {
    setImageViewer(prev => ({ ...prev, isOpen: false }));
  };

  // ÂàáÊç¢Âà∞‰∏ä‰∏ÄÂº†ÂõæÁâá
  const goToPreviousImage = () => {
    setImageViewer(prev => ({
      ...prev,
      currentIndex: (prev.currentIndex - 1 + prev.images.length) % prev.images.length
    }));
  };

  // ÂàáÊç¢Âà∞‰∏ã‰∏ÄÂº†ÂõæÁâá
  const goToNextImage = () => {
    setImageViewer(prev => ({
      ...prev,
      currentIndex: (prev.currentIndex + 1) % prev.images.length
    }));
  };

  return (
    <Container>
      <HeaderSection>
        <motion.div
          initial={{ opacity: 0, y: -30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
        >
          <Title>
            <Icon><img src="images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁÅØÂ°îÂõæÊ†á.webp" alt="ÁÅØÂ°î" /></Icon>
            Áî∑Êú®Â≤õ
            <Icon><img src="images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õ-ÁÅØÂ°îÂõæÊ†á.webp" alt="ÁÅØÂ°î" /></Icon>
          </Title>
          <Subtitle>ÂÆÅÈùôÁöÑÁå´Â≤õÊ∏îÊùë</Subtitle>
        </motion.div>
      </HeaderSection>

      <ContentContainer>
        <InfoCard
          initial={{ opacity: 0, y: 50 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.2 }}
        >
          <TabContainer>
            <TabButton
              active={activeTab === 'intro'}
              tabType="intro"
              onClick={() => setActiveTab('intro')}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
            >
              üèùÔ∏è Â≤õÂ±ø‰ªãÁªç
            </TabButton>
            <TabButton
              active={activeTab === 'guide'}
              tabType="guide"
              onClick={() => setActiveTab('guide')}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
            >
              üó∫Ô∏è Â∑°Á§ºËØ¥Êòé
            </TabButton>
          </TabContainer>

          <AnimatePresence mode="wait">
            {activeTab === 'intro' ? (
              <ContentSection
                key="intro"
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                exit={{ opacity: 0, x: 20 }}
                transition={{ duration: 0.3 }}
              >
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.6, delay: 0.1 }}
                >
                  <Description>
                    Áî∑Êú®Â≤õÊòØÁÄ¨Êà∏ÂÜÖÊµ∑‰∏≠ÁöÑ‰∏Ä‰∏™ÂÆÅÈùôÂ∞èÂ≤õÔºå‰ª•ÂÖ∂‰º†ÁªüÁöÑÊ∏îÊùëÈ£éË≤åËÄåÈóªÂêç„ÄÇËøôÈáåÁöÑÂ±ÖÊ∞ë‰∏ñ‰ª£‰ª•Ê∏î‰∏ö‰∏∫ÁîüÔºåÂ≤õ‰∏äÁöÑÁîüÊ¥ªËäÇÂ•èÁºìÊÖ¢ËÄåÊÇ†ÁÑ∂„ÄÇ
                  </Description>
                  <Description>
                    Áî∑Êú®Â≤õÁöÑÁå´Âí™ÁâπÂà´Â§öÔºåË¢´Áß∞‰∏∫"Áå´Â≤õ"ÔºåËøô‰∫õÂèØÁà±ÁöÑÁå´Âí™ÊòØÂ≤õ‰∏äÁöÑÁâπËâ≤‰πã‰∏Ä„ÄÇ
                  </Description>
                </motion.div>
              </ContentSection>
            ) : (
              <ContentSection
                key="guide"
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                exit={{ opacity: 0, x: 20 }}
                transition={{ duration: 0.3 }}
              >
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.6, delay: 0.1 }}
                >
                  <Description>
                    Áî∑Êú®Â≤õÁöÑÂ∑°Á§ºË∑ØÁ∫ø‰∏ªË¶ÅÂàÜ‰∏∫ÂçóÂåó‰∏§‰∏™ÊñπÂêëÔºåÂåóËæπÊúÄËøúÁöÑ‰ΩçÁΩÆÊòØÁÅØÂ°îÔºåÂçóËæπÊúÄËøúÁöÑ‰ΩçÁΩÆÊòØÂíåÈ∏•Áõ∏ÈÅáÁöÑÁº∫Âè£Ê†èÊùÜ„ÄÇ
                  </Description>
                  <Description>
                    Áî∑Êú®Â≤õÂÖ±Êúâ10‰∏™Â∑°Á§ºÁÇπÔºåÂÖ∂‰∏≠9‰∏™ÂèØÊãçÁÖßÔºå8‰∏™ÂèØËøòÂéüÔºåÂ∑°Á§ºÊé®ËçêË∑ØÁ∫øÂ¶Ç‰∏ãÔºö
                  </Description>
                  <Description>
                    ÂåóËæπÔºöÊîæÈÄÅÂ°î ‚Üí ËãçÁù°ËßâÂ∞èÈÅì ‚Üí È¨ºÂß¨Á•ûÂ±±ËØÜ‰πãÂ¢ì ‚Üí ÁÅØÂ°î
                  </Description>
                  <Description>
                    ‰∏≠Èó¥ÔºöÊîæÈÄÅÂ°î ‚Üí Èùô‰πÖÁ•ûÁ§æ
                  </Description>
                  <Description>
                    ÂçóËæπÔºöÊîæÈÄÅÂ°î ‚Üí È∏üÁôΩÂ≤õÂΩπÂú∫ ‚Üí  Èò≤Ê≥¢Â†§ ‚Üí ÁßòÂØÜÂü∫Âú∞ÔºàÊ≥≥Ê±†Ôºâ ‚Üí È∏•Áõ∏ÈÅáÂ∞èÈÅì
                  </Description>
                  <Description>
                    ÂÖ∂‰ªñËØ¥ÊòéÔºö
                    <div style={{ textIndent: '2em' }}>
                        1. Áî∑Êú®Â≤õÁöÑÂ∑°Á§ºÊñπÂºè‰∏∫Ê≠•Ë°åÔºåÁÅØÂ°îË∑ùÁ¶ªËæÉËøúÔºåËØ∑ÂÆâÊéíÂ•ΩÊó∂Èó¥„ÄÇ
                      </div>
                      <div style={{ textIndent: '2em' }}>
                        2. ÊîæÈÄÅÂ°î‰∏äÂ≤õÂç≥ÂèØÁúãËßÅÔºåÂèØ‰ª•‰Ωú‰∏∫Áî∑Êú®Â≤õÂ∑°Á§ºËµ∑ÁÇπ„ÄÇ
                      </div>
                      <div style={{ textIndent: '2em' }}>
                        3. ‰∏§‰∏™ÁÇπÊó†Ê≥ïËøòÂéüÔºåÁßòÂØÜÂü∫Âú∞Â±û‰∫é‰∏∞Áà∑ÁÆÄÂçïËá™Âª∫ÔºåÊ≥≥Ê±†Á¶ÅÊ≠¢ÊãçÁÖß„ÄÇ
                      </div>
                      <div style={{ textIndent: '2em' }}>
                        4. ÊúâÊó∂Èó¥ÂèØ‰ª•Âíå‰∏∞Áà∑ËÅäÂ§©Ôºå‰∏∞Áà∑‰∫∫ÂæàÂ•ΩÔºå‰πüÊòØSPÁ≤â„ÄÇ
                      </div>
                  </Description>
                </motion.div>
              </ContentSection>
            )}
          </AnimatePresence>
        </InfoCard>

        <motion.div
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ duration: 0.8, delay: 0.4 }}
        >
          <MapFrame>
            <MapContainer>
              <MapImage scale={mapScale} src="images/webps/Áî∑Êú®Â≤õ/Áî∑Êú®Â≤õÂú∞Âõæ-Á∫øË∑ØÁâà.webp" alt="Áî∑Êú®Â≤õÂú∞Âõæ" />
              <MapOverlay>
                {/* ÊâìÂç°ÁÇπÊ†áËÆ∞ */}
                {checkInIcons.map((icon, index) => (
                  <LocationIcon
                    key={icon.title}
                    x={icon.x}
                    y={icon.y}
                    iconSize={icon.size}
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    transition={{ delay: 1 + index * 0.1, duration: 0.5 }}
                    whileHover={{ scale: 1.2 }}
                    title={icon.title}
                    onMouseEnter={() => setHoveredIcon(icon.title)}
                    onMouseLeave={() => setHoveredIcon(null)}
                  >
                    {icon.iconType === 'image' ? (
                      <img src={icon.icon} alt={icon.title} />
                    ) : (
                      icon.emoji
                    )}
                    {/* ÊÇ¨ÂÅúTooltipÔºåÊ∏≤ÊüìÂú®Âú∞Ê†áÂÜÖÈÉ® */}
                    {hoveredIcon === icon.title && iconTooltips[icon.title] && (
                      <MapTooltip direction="top">
                        <TooltipImage src={iconTooltips[icon.title].image} alt={icon.title} />
                        <TooltipTitle>{icon.title}</TooltipTitle>
                        <TooltipDesc>{iconTooltips[icon.title].desc}</TooltipDesc>
                      </MapTooltip>
                    )}
                  </LocationIcon>
                ))}
              </MapOverlay>
              {/* ÁßªÈô§ÂéüÊúâÁöÑfixed TooltipÊ∏≤Êüì */}
            </MapContainer>
          </MapFrame>
        </motion.div>

        <InfoCard
          initial={{ opacity: 0, y: 50 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.6 }}
        >
          <SectionTitle>ÊâìÂç°Âú∞ÁÇπ</SectionTitle>
          <ImageGallery>
            {checkInLocations.map((location) => (
              <ImageCard
                key={location.title}
                whileHover={{ scale: 1.02 }}
                transition={{ duration: 0.3 }}
                initial={{ opacity: 0, y: 30 }}
                animate={{ opacity: 1, y: 0 }}
                onClick={() => openImageViewer(location.images, 0, location.title)}
                style={{ cursor: 'pointer' }}
              >
                <ImageSlider
                  images={location.images}
                  title={location.title}
                  autoPlay={true}
                  interval={4000}
                  onImageClick={(imageIndex) => openImageViewer(location.images, imageIndex, location.title)}
                />
                <LocationTitle>{location.title}</LocationTitle>
                <ImageCaption>{location.description}</ImageCaption>
              </ImageCard>
            ))}
          </ImageGallery>
        </InfoCard>
      </ContentContainer>

      <ButtonContainer>
        <BackButton
          onClick={handleBack}
          whileHover={{ scale: 1.05 }}
          whileTap={{ scale: 0.95 }}
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.8 }}
        >
          ËøîÂõûÊâìÂç°ÁØá
        </BackButton>
      </ButtonContainer>

      {/* ÂõæÁâáÊü•ÁúãÂô®Ê®°ÊÄÅÊ°Ü */}
      <ImageViewer
        isOpen={imageViewer.isOpen}
        onClose={closeImageViewer}
        images={imageViewer.images}
        currentIndex={imageViewer.currentIndex}
        onPrevious={goToPreviousImage}
        onNext={goToNextImage}
        title={imageViewer.title}
      />
    </Container>
  )
}

export default OgijimaPage 