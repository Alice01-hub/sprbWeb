# Summer Pockets 巡礼网站 - 公网部署说明

## 🌐 公网访问地址

**域名**: `sprb.love`  
**服务器IP**: `8.148.187.117`

### 主要服务 (HTTPS域名访问)
- **主网站**: https://sprb.love ✅
- **主后端API**: https://sprb.love/api/ ✅
- **后台管理**: https://sprb.love/admin/ ✅
- **后台管理API**: https://sprb.love/admin-api/ ✅

### 备用IP访问
- **主网站**: http://8.148.187.117
- **主后端API**: http://8.148.187.117/api/
- **后台管理**: http://8.148.187.117/admin/
- **后台管理API**: http://8.148.187.117/admin-api/

### 直接端口访问 (开发调试用)
- **主前端**: http://8.148.187.117:3000
- **主后端API**: http://8.148.187.117:8000
- **后台管理前端**: http://8.148.187.117:3001
- **后台管理API**: http://8.148.187.117:8001

### API文档
- **主API文档**: https://sprb.love/api/docs (或 http://8.148.187.117:8000/docs)
- **后台API文档**: https://sprb.love/admin-api/docs (或 http://8.148.187.117:8001/docs)

## 🚀 部署状态

✅ **部署成功** - 所有服务已成功部署到公网

### 服务状态
- ✅ Nginx反向代理 - 端口 80/443 (域名: sprb.love, SSL证书)
- ✅ 主前端 (React 生产构建) - 端口 3000
- ✅ 主后端 (FastAPI) - 端口 8000  
- ✅ 后台管理前端 (React) - 端口 3001
- ✅ 后台管理API (FastAPI) - 端口 8001

## 🔧 技术配置

### 网络配置
- **域名**: sprb.love → 8.148.187.117
- **SSL证书**: Let's Encrypt (自动续期)
- **监听地址**: 0.0.0.0 (所有网络接口)
- **反向代理**: Nginx (端口80/443) → 各服务端口
- **HTTPS重定向**: HTTP自动重定向到HTTPS
- **前端部署**: 生产构建 (静态文件服务)
- **防火墙**: 已配置允许相关端口访问
- **CORS**: 已配置允许跨域访问

### 环境信息
- **操作系统**: Linux Ubuntu 22.04
- **Python**: 3.9 (conda环境: sprbWeb)
- **Node.js**: v18.20.8
- **数据库**: SQLite

## 📋 管理命令

### 启动服务
```bash
cd /root/workspace/sprbWeb
./start.sh
```

### 停止服务
```bash
cd /root/workspace/sprbWeb
./stop.sh
```

### 查看日志
```bash
cd /root/workspace/sprbWeb
tail -f backend.log frontend.log admin_backend.log admin_frontend.log
```

### Nginx和SSL管理
```bash
./nginx-manage.sh status     # 查看状态
./nginx-manage.sh restart    # 重启服务
./nginx-manage.sh reload     # 重新加载配置
./nginx-manage.sh ssl-status # 查看SSL证书状态
./nginx-manage.sh ssl-renew  # 手动续期SSL证书
```

### 检查服务状态
```bash
# 检查所有端口
netstat -tlnp | grep -E ":(80|443|3000|8000|3001|8001)"

# 检查应用进程
ps aux | grep -E "(uvicorn|node|nginx)" | grep -v grep

# 检查nginx状态
systemctl status nginx

# 测试HTTPS访问
curl -I https://sprb.love
curl https://sprb.love/api/health

# 测试HTTP重定向
curl -I http://sprb.love

# 测试IP访问
curl -I http://8.148.187.117
curl http://8.148.187.117/api/health
```

## 🛠️ 维护说明

### 重启服务
如果需要重启服务，执行：
```bash
./stop.sh && ./start.sh
```

### 更新代码
如果需要更新代码：
```bash
git pull origin main
./stop.sh
./start.sh
```

### 数据库备份
数据库文件位于：
- 主数据库: `backend/data/shenyu.db`
- 交通数据: `backend/data/traffic_cards.db`

建议定期备份这些文件。

## 🔒 安全注意事项

1. **端口访问**: 当前所有端口都对公网开放，建议根据需要配置防火墙规则
2. **数据库安全**: SQLite数据库文件需要定期备份
3. **日志管理**: 定期清理日志文件，避免磁盘空间不足
4. **依赖更新**: 定期更新Python和Node.js依赖包

## 📞 技术支持

如遇到问题，可以：
1. 查看日志文件排查问题
2. 检查服务进程状态
3. 验证网络连接和端口状态
4. 重启相关服务

---

**部署时间**: 2025年8月4日  
**部署状态**: ✅ 成功  
**最后更新**: 2025年8月4日 20:17 UTC+8