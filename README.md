# Summer Pockets 巡礼网站

> 重回那个夏天，探索三岛的美好时光

<div align="center">
  <img src="frontend/public/images/sprb封面图.png" alt="Summer Pockets" width="400">
</div>

## 🌅 项目介绍

这是一个基于 **Summer Pockets** 游戏的圣地巡礼网站，旨在帮助玩家重现游戏中那个难忘的夏天，提供详细的巡礼指南和打卡信息。

### ✨ 主要功能

- 🏠 **首页日记本** - 精美的日记本界面设计，配合BGM营造夏日氛围
- 📖 **目录页面** - 书本样式的导航界面，悬停查看各篇章摘要
- 🚌 **交通篇** - 完整的交通攻略系统，包含巡礼清单功能，支持PDF文件下载和进度追踪
- 📍 **打卡篇** - 三岛地图和打卡点详情（开发中）
- 🦋 **神域** - 神秘的特殊区域，正在开发中，即将提供七影碟寄存等独特功能
- 🎵 **音乐播放器** - 简洁的圆形按钮播放器，支持菜单式播放控制
- 🎨 **3D动画** - 流畅的页面过渡和交互效果
- 🦋 **七影碟拖尾特效** - 基于TextCursor逻辑的鼠标拖尾效果，七影碟图片跟随鼠标移动，支持随机浮动和旋转动画
- 🚀 **FastAPI后端** - 高性能异步后端服务，支持音乐API和完整的API文档

### 🎨 视觉设计特色

- **圆形音乐播放器** - 简洁的圆形按钮设计，点击打开播放菜单
- **菜单式播放控制** - 所有播放功能集中在菜单中，包含播放/暂停、上下曲切换、音量调节等
- **双播放模式** - 支持列表循环和单曲循环两种播放模式
- **智能自动播放** - 用户交互时自动启动BGM播放，无需手动操作
- **可视化播放列表** - 完整的播放列表显示，点击即可切换曲目
- **精确音量控制** - 滑块式音量控制，调节时不会重新播放音乐 ✨
- **BGM标题匹配** - 后端API驱动的播放列表，确保BGM与标题完全对应 ✨
- **BGM切换修复** - 修复了切换BGM时播放错误音轨的问题，确保准确播放选中的音乐 🔧
- **🔓 自定义锁图标** - 使用七影碟系列图片作为锁图标，支持悬停效果切换，位置可调节 ✨
- **🦋 七影碟拖尾特效** - 智能鼠标拖尾系统，基于官方TextCursor组件逻辑实现 ✨
  - 📐 **智能间距控制** - 根据鼠标移动距离自动生成拖尾点，间距可配置
  - 🎭 **方向感知** - 七影碟图片根据鼠标移动方向自动调整角度
  - 🌊 **随机浮动** - 每个拖尾元素具有独特的随机浮动和旋转动画
  - 🌈 **色彩变化** - 自动应用色相旋转，每个拖尾元素呈现不同色彩
  - ⏱️ **性能优化** - 智能清理机制，防止内存泄漏，可配置拖尾长度和更新频率
  - 💫 **淡出效果** - 优雅的透明度和缩放淡出动画，可自定义退出时长
- **🦋 目录页蝴蝶动画** - 目录页每个章节标题右侧常驻蝴蝶图标，悬停时显示翅膀闪动效果 ✨
  - 🖼️ **双图循环播放** - 使用七影碟-3.png和七影碟-4.png图片循环播放，模拟蝴蝶翅膀闪动
  - 🎯 **默认显示** - 非悬停状态下默认显示七影碟-4.png图片作为静态蝴蝶图标
  - ⚡ **智能动画控制** - 悬停时开始400ms周期的图片循环，离开时恢复默认图片
  - 🌃 **深邃星空背景** - 悬停时显示深蓝到黑色的渐变背景，营造深邃夜空效果
  - ⭐ **星空粒子特效** - 悬停时显示25个随机分布的闪烁星星，每个星星都有独特的动画效果
    - 💫 **闪烁动画** - 星星具有随机的闪烁周期和光晕效果
    - 🌊 **浮动效果** - 星星微妙的上下浮动动画，增强动态感
    - 🎨 **随机生成** - 每次加载时星星位置、大小、动画延迟都随机生成
  - 🎨 **流畅过渡效果** - 蝴蝶出现/消失时的淡入淡出和缩放动画
  - 📍 **精确定位** - 蝴蝶图标位于标题右侧，不影响页面布局
  - 🔧 **尺寸可调** - 通过size参数控制蝴蝶图片大小（默认150px）
- **统一夏日背景** - 首页和目录页采用一致的温暖渐变背景
- **简洁交通攻略** - 白底黑字设计，清晰易读，专注内容本身
- **集成巡礼清单** - 交通篇整合巡礼清单功能，交互式任务清单，实时进度追踪
- **手写体美学** - 首页标题采用手写体风格，配合emoji装饰
- **夏日元素动画** - 太阳、海浪、棕榈树、火烈鸟等emoji在背景浮动
- **夏日日记本设计** - 米色纸张质感，橙色装订线设计  
- **3D立体感** - 丰富的3D旋转和缩放动画效果

### 🏝️ 涵盖岛屿

- **女木岛** - 以鬼岛传说而闻名
- **男木岛** - 宁静的渔村小岛  
- **直岛** - 现代艺术的圣地

## 🚀 快速开始

### 📋 系统要求

- Node.js 16+ 
- npm 或 yarn
- Python 3.9+
- conda (推荐)
- 现代浏览器（Chrome 80+, Firefox 75+, Safari 13+）

### 🔧 安装步骤

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd sprb-web
   ```

2. **一键启动** ⭐
   ```bash
   # 推荐：使用一键启动脚本
   ./start.sh
   
   # 停止所有服务
   ./stop.sh
   ```
   
   启动脚本会自动：
   - 🔧 强制关闭占用端口（3000、8000）
   - 🐍 激活conda虚拟环境 "sprb-web"
   - 📦 检查并安装前后端依赖
   - 🚀 启动前后端服务（后台运行）
   - 🌐 显示服务状态和访问地址
   - 📝 生成详细的启动日志

3. **服务器管理**
   ```bash
   # 一键启动所有服务（自动清理端口、激活环境、安装依赖）
   ./start.sh
   
   # 停止所有服务
   ./stop.sh
   
   # 重启所有服务
   ./stop.sh && ./start.sh
   
   # 查看运行日志
   tail -f logs/backend.log
   tail -f logs/frontend.log
   
   # 检查服务状态
   ps aux | grep -E "(python|node)"
   ```

4. **访问网站**
   - 前端访问: http://localhost:3000
   - 后端API: http://localhost:8000
   - API文档: http://localhost:8000/docs

### 🚀 一键启动特性

- **🔧 智能端口清理**: 自动检测并清理3000、8000端口占用
- **🐍 虚拟环境管理**: 自动创建/激活conda虚拟环境"sprb-web"
- **📦 依赖自动检查**: 自动检查并安装前后端所需依赖
- **🚀 并行服务启动**: 同时启动前端(React+Vite)和后端(FastAPI)服务
- **📊 PID进程管理**: 自动保存进程ID，支持优雅停止
- **📝 详细日志记录**: 完整的服务日志记录到logs目录
- **🌐 状态实时监控**: 清晰的启动状态和访问信息显示
- **🎨 美观命令行界面**: 带颜色的状态信息和进度提示

### 📝 启动脚本详细说明

#### 🚀 start.sh - 一键启动脚本
```bash
# 完整启动流程
./start.sh

# 脚本执行步骤：
# 1. 检查并清理端口占用（3000、8000）
# 2. 激活conda虚拟环境 "sprb-web"
# 3. 检查并安装后端依赖（requirements.txt）
# 4. 检查并安装前端依赖（package.json）
# 5. 启动后端服务（Python FastAPI）
# 6. 启动前端服务（React + Vite）
# 7. 检查服务状态并显示访问地址
```

#### 🛑 stop.sh - 停止脚本
```bash
# 停止所有服务
./stop.sh

# 脚本执行步骤：
# 1. 根据PID文件停止前后端服务
# 2. 强制清理端口占用
# 3. 清理相关Python和Node.js进程
# 4. 删除PID文件
```

#### 📁 生成的文件
- `backend.pid` - 后端进程ID
- `frontend.pid` - 前端进程ID
- `logs/backend.log` - 后端运行日志
- `logs/frontend.log` - 前端运行日志

## 🛠️ 技术栈

### 前端框架
- ⚛️ **React 18** - 现代化用户界面
- 🔷 **TypeScript** - 类型安全开发
- ⚡ **Vite** - 快速构建工具

### 后端服务
- 🐍 **Python 3.9** - 后端开发语言
- 🚀 **FastAPI** - 高性能异步Web框架
- 📊 **SQLite** - 轻量级数据库
- 📄 **ReportLab** - PDF生成库

### 样式方案
- 💅 **Styled Components** - CSS-in-JS 样式管理
- 🎬 **Framer Motion** - 流畅动画效果
- 🌞 **夏日主题配色** - 温暖明亮的天空渐变配色

### 开发工具
- 🔀 **React Router** - 路由管理
- 🎵 **智能BGM播放系统** - 支持自动循环播放和曲目控制
- 🦋 **ImageCursor组件** - 基于TextCursor逻辑的图片拖尾特效系统
- ⭐ **StarryBackground组件** - 深邃星空背景和粒子特效系统
- 📱 **响应式设计** - 移动端适配
- 📄 **PDF生成** - 支持中文的巡礼清单PDF下载

### 特效技术
- 🎯 **智能鼠标追踪** - 实时监听鼠标移动，精确计算拖尾位置
- 📐 **数学算法优化** - 使用向量计算和三角函数实现方向感知
- 🎨 **动态样式渲染** - CSS-in-JS结合内联样式实现色彩变化
- ⚡ **性能优化策略** - 间距控制、定时清理、RAF优化确保流畅体验
- ⭐ **粒子系统** - 随机生成星星粒子，每个粒子具有独立的动画周期和属性
- 🌊 **关键帧动画** - 使用CSS关键帧实现星星闪烁和浮动效果
- 🎭 **渐变背景** - 多层渐变色彩模拟深邃夜空视觉效果

## 📁 项目结构

```
sprb-web/
├── 素材/                # 素材文件
│   ├── audio/           # BGM音频文件
│   └── 巡礼清单.md      # 巡礼任务清单（Markdown格式）
├── frontend/            # 前端项目
│   ├── public/         # 静态资源
│   │   ├── images/     # 图片素材（包含锁图标：七影碟-3.png、七影碟-4.png）
│   │   ├── audio/      # BGM音频文件
│   │   └── files/      # 下载文件（包含巡礼清单PDF）
│   ├── src/
│   │   ├── components/ # 可复用组件
│   │   │   ├── MusicPlayer.tsx      # 网易云风格音乐播放器
│   │   │   ├── TrafficInfoGrid.tsx  # 交通攻略信息网格
│   │   │   ├── ButterflyAnimation.tsx # 蝴蝶动画组件（悬停时的七影碟图片循环播放）
│   │   │   └── StarryBackground.tsx # 星空背景组件（深邃夜空背景和闪烁星星粒子特效）
│   │   ├── contexts/   # 全局上下文
│   │   │   └── MusicContext.tsx     # 音乐播放状态管理
│   │   ├── pages/      # 页面组件
│   │   │   ├── HomePage.tsx         # 首页日记本
│   │   │   ├── ContentsPage.tsx     # 目录页
│   │   │   ├── TrafficPage.tsx      # 交通篇（包含巡礼清单功能）
│   │   │   ├── CheckinPage.tsx      # 打卡篇
│   │   │   └── DivineRealmPage.tsx  # 神域页面（重命名）
│   │   ├── styles/     # 样式文件
│   │   └── types/      # 类型定义
│   ├── package.json   # 前端依赖
│   └── vite.config.ts # Vite配置
├── backend/            # FastAPI后端
│   ├── app.py         # FastAPI应用入口
│   ├── requirements.txt # Python依赖
│   ├── data/          # 数据存储目录
│   │   ├── traffic_cards.db      # 交通卡片数据库
│   │   └── traffic_guides.json   # 交通指南数据
│   └── uploads/       # 文件上传目录
├── logs/              # 日志文件
├── start.sh           # 一键启动脚本（前后端）
└── README.md         # 项目说明
```

## 🎮 使用说明

### 导航方式
1. **首页**: 欣赏夜空星辰，点击日记本右侧的自定义锁图标观看翻页动画（悬停时图标会变化）
2. **目录页**: 悬停篇章标题查看摘要，点击进入对应页面
3. **返回**: 各页面返回按钮位置优化，操作更便捷

### 音频控制
- 🎵 **圆形音乐播放器** - 简洁的圆形按钮设计，点击打开播放菜单
- 🎛️ **菜单式播放控制** - 所有播放功能集中在菜单中，包含播放/暂停、上下首、进度跳转、音量调节
- 🔄 **双播放模式** - 支持列表循环和单曲循环两种播放模式
- 📋 **完整播放列表** - 显示所有可用歌曲，点击即可切换播放
- 🎯 **歌曲选择播放** - 点击播放列表中的任意歌曲直接切换播放
- 🔊 **精确音量控制** - 滑块式音量控制，支持0-100%精确调节，调节时不会重新播放音乐 ✨
- ⏱️ **进度条显示** - 实时显示播放进度，支持点击跳转到指定位置
- 🌐 **后端数据驱动** - 播放列表从后端API加载，支持歌曲元数据管理，确保BGM与标题完全对应 ✨
- ⚡ **全局状态管理** - 基于React Context，页面切换时音频状态完全保持
- 🎨 **简洁界面** - 统一的播放控制界面，操作直观便捷
- 🐛 **音量调节优化** - 修复了音量调节时重新播放音乐的问题 ✨
- 🎼 **BGM标题匹配** - 确保播放的BGM与显示的标题完全对应 ✨
- 🔧 **BGM切换修复** - 修复了切换BGM时播放错误音轨的问题，采用智能状态管理确保准确播放 ✨

### 巡礼清单功能
- 📋 **交互式清单** - 完整的巡礼任务清单，支持勾选完成（现已集成到交通篇）
- 📊 **进度追踪** - 实时显示完成进度和百分比
- 📄 **直接PDF下载** - 改为直接下载预设的PDF文件，无需API调用，响应更快
- 📝 **鸟白岛巡礼清单** - 专门的鸟白岛巡礼清单PDF，包含详细的巡礼信息
- 🖨️ **打印友好** - PDF格式支持直接打印，适合实地巡礼使用
- ✅ **任务分类** - 按出行准备、交通、行程等分类整理
- 🚌 **与交通攻略整合** - 巡礼清单现已整合到交通篇中，方便一站式查看
- 📋 **详细信息** - 包含巡礼地点详细信息、推荐APP、实用贴士等
- 💡 **预算参考** - 提供详细的预算参考和行李建议
- ⚡ **无需后端** - 直接从前端静态文件下载，提高稳定性和响应速度

### 交互特色
- ⭐ **星空动画** - 100颗星星随机闪烁，营造夜空氛围
- 📖 **3D翻页效果** - 180度旋转翻页，配合淡入淡出过渡
- 🔓 **自定义锁图标** - 使用七影碟-4.png作为默认图标，悬停时切换为七影碟-3.png，支持缩放和发光效果
- 📚 **书本目录** - 左右分栏设计，红色装订线细节
- ✨ **流畅过渡** - 页面间的平滑动画切换
- 🎨 **优化布局** - 返回按钮位置调整，用户体验更佳
- 🦋 **蝴蝶动画** - 目录页标题右侧常驻蝴蝶图标，悬停时显示翅膀闪动效果，配合深邃星空背景和粒子特效，营造梦幻的视觉体验

### 浏览器兼容性
现代浏览器自动播放政策要求用户交互才能播放音频，本站已实现智能自动播放：在用户首次交互（点击、滚动、键盘等）时自动开始播放BGM。

## 📈 更新日志

### v1.1 (2025-07-13) - 深邃星空主题优化 🌃⭐

#### 🦋 蝴蝶动画增强
- **深邃星空背景** - 悬停时显示深蓝到黑色的渐变背景，营造深邃夜空效果
- **星空粒子特效** - 新增25个随机分布的闪烁星星，每个星星都有独特的动画效果
- **星星动画效果** - 星星具有随机的闪烁周期、光晕效果和微妙的浮动动画
- **默认显示优化** - 非悬停状态下默认显示七影碟-4.png图片作为静态蝴蝶图标
- **尺寸调整** - 优化蝴蝶图片默认尺寸为150px，提供更好的视觉效果
- **标题颜色调整** - 悬停时标题颜色改为纯白色，在深色背景下更加清晰
- **图标主题适配** - 章节图标悬停时也采用夜空主题配色

#### 🔧 开发优化
- **端口管理** - 优化端口管理，避免多余进程占用
- **代码注释** - 增加详细的尺寸调整位置注释说明
- **组件化设计** - 新增StarryBackground组件，实现可复用的星空粒子特效

### v1.0 (2025-07-12) - 首个发布版本 🎉

#### 🎵 音乐播放器系统
- **圆形音乐播放器** - 简洁的圆形按钮设计，点击打开播放菜单
- **菜单式播放控制** - 所有播放功能集中在菜单中，包含播放/暂停、上下首、进度跳转、音量调节
- **双播放模式** - 支持列表循环和单曲循环两种播放模式
- **完整播放列表** - 显示所有可用歌曲，点击即可切换播放
- **智能播放控制** - 切换播放模式时不会中断当前BGM播放
- **精确音量控制** - 滑块式音量控制，支持0-100%精确调节，调节时不会重新播放音乐 ✨
- **进度条显示** - 实时显示播放进度，支持点击跳转到指定位置
- **后端API集成** - 音乐播放列表API，支持歌曲元数据管理和播放统计
- **全局状态管理** - 基于React Context，页面切换时音频状态完全保持
- **简洁界面** - 统一的播放控制界面，操作直观便捷
- **智能自动播放** - 用户交互时自动启动BGM播放，无需手动操作

#### 🐛 音乐播放器优化修复
- **音量调节优化** - 修复了音量调节时重新播放音乐的问题
- **BGM标题匹配** - 确保播放的BGM与显示的标题完全对应
- **BGM切换修复** - 修复了切换BGM时播放错误音轨的问题，采用智能状态管理确保准确播放
- **播放列表同步** - 前后端播放列表完全同步，避免标题与音乐不匹配
- **暂停恢复优化** - 改进了暂停后恢复播放的逻辑，避免重新开始播放

#### 🏠 网站核心功能
- **首页日记本** - 精美的日记本界面设计，配合BGM营造夏日氛围
- **目录页面** - 书本样式的导航界面，悬停查看各篇章摘要
- **交通篇** - 完整的交通攻略系统，包含巡礼清单功能，支持PDF文件下载和进度追踪
- **打卡篇** - 三岛地图和打卡点详情（开发中）
- **神域** - 神秘的特殊区域，正在开发中
- **3D动画** - 流畅的页面过渡和交互效果

#### 🚀 后端服务
- **FastAPI后端** - 高性能异步后端服务，支持完整的API文档
- **后端API优化** - 优化了音乐播放列表API的数据结构和排序逻辑
- **RESTful API** - 完整的API接口支持，包含音乐、交通、打卡等功能

#### 📄 巡礼清单功能
- **交互式任务清单** - 实时进度追踪，支持PDF下载
- **直接PDF下载** - 无需API调用，响应更快
- **鸟白岛专属清单** - 专门的鸟白岛巡礼清单PDF
- **与交通攻略整合** - 巡礼清单整合到交通篇中

#### 🎨 视觉设计
- **夏日主题** - 温暖明亮的天空渐变配色，夏日元素动画
- **3D立体感** - 丰富的3D旋转和缩放动画效果
- **星空动画** - 100颗星星随机闪烁，营造夜空氛围
- **3D翻页效果** - 180度旋转翻页，配合淡入淡出过渡
- **🔓 自定义锁图标** - 使用七影碟系列图片替换原有CSS绘制的锁图标，增强视觉效果 ✨
- **🦋 目录页蝴蝶动画** - 目录页每个章节标题右侧常驻蝴蝶图标，悬停时显示翅膀闪动效果，使用七影碟图片循环播放，配合深邃星空背景和粒子特效 ✨

#### 🔧 开发工具
- **一键启动脚本** - 完整的启动脚本，自动处理依赖安装和服务启动
- **启动脚本优化** - 完善了一键启动脚本，支持conda环境管理
- **服务管理** - 新增stop.sh和restart.sh脚本，便于服务管理
- **PID管理** - 自动保存进程ID，便于管理
- **日志记录** - 完整的服务日志记录

## 🔧 开发说明

### 开发环境配置
```bash
# 1. 克隆项目
git clone <repository-url>
cd sprb-web

# 2. 创建conda环境
conda create -n sprb-web python=3.9
conda activate sprb-web

# 3. 安装后端依赖
pip install -r backend/requirements.txt

# 4. 安装前端依赖
cd frontend
npm install

# 5. 启动开发服务器
npm run dev
```

### 素材文件要求
```
frontend/public/
├── images/
│   ├── sprb封面图.png
│   ├── 交通篇摘要图.png
│   ├── 打卡篇摘要图.png
│   ├── 其他巡礼摘要图.jpg
│   ├── 七影碟-3.png          # 锁图标悬停状态
│   └── 七影碟-4.png          # 锁图标默认状态
└── audio/
    └── 水月陵 - Summer Pockets.mp3
```

### API 接口文档
FastAPI提供了完整的API文档，访问 http://localhost:8000/docs 查看。

主要接口包括：
```
GET  /api/health                    # 健康检查
GET  /api/download-checklist        # 下载PDF清单（支持中文）
GET  /api/audio-files               # 获取可用音频文件列表
GET  /api/music/playlist            # 获取完整音乐播放列表（包含歌曲元数据）
GET  /api/music/track/{track_id}    # 获取单个音轨详细信息
POST /api/music/play-stats          # 记录播放统计数据
GET  /api/traffic-cards             # 获取交通卡片
POST /api/traffic-cards             # 创建交通卡片
PUT  /api/traffic-cards/{id}        # 更新交通卡片
DELETE /api/traffic-cards/{id}      # 删除交通卡片
GET  /api/traffic-guides            # 获取交通指南
POST /api/traffic-guides            # 保存交通指南
```

### 部署说明
1. 确保服务器安装了Node.js和Python
2. 使用一键启动脚本进行部署
3. 配置反向代理指向3000端口
4. 确保素材文件正确放置
5. 后端API运行在8000端口

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 贡献类型
- 🐛 Bug修复
- ✨ 新功能开发
- 📚 文档改进
- 🎨 UI/UX优化
- 🔧 性能优化

### 开发流程
1. Fork项目
2. 创建功能分支
3. 提交代码
4. 发起Pull Request

## 📄 许可证

本项目仅供学习交流使用，请勿用于商业用途。

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者和设计师！

---

<div align="center">
  <p>🌟 如果这个项目对你有帮助，请给个Star支持一下！</p>
  <p>💫 让我们一起重回那个美好的夏天！</p>
</div> 